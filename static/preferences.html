<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Preferences - PocketLetter</title>
    <link rel="stylesheet" href="/static/css/styles.css" />
</head>

<body>
    <div class="container">
        <section class="section">
            <div class="columns">
                <div
                    class="column is-8-tablet is-offset-2-tablet is-8-desktop is-offset-2-desktop is-6-widescreen is-offset-3-widescreen">
                    <h1 class="title is-2">Email Preferences</h1>
                    <form id="preferencesForm" action="/save-preferences" method="POST">
                        <input type="hidden" id="pocketUserName" name="pocketUserName" value="{{ pocketUserName }}" />
                        <input type="hidden" id="hdnEmailAddress" name="hdnEmailAddress" value="{{ emailAddress }}" />
                        <input type="hidden" id="hdnLinkCountPerEmail" name="hdnLinkCountPerEmail"
                            value="{{ linkCountPerEmail }}" />
                        <input type="hidden" id="hdnEmailFrequency" name="hdnEmailFrequency"
                            value="{{ emailFrequency }}" />
                        <input type="hidden" id="hdnWeeklyOnDay" name="hdnWeeklyOnDay" value="{{ weeklyOnDay }}" />
                        <input type="hidden" id="hdnSortType" name="hdnSortType" value="{{ sortType }}" />
                        <input type="hidden" id="hdnSubscribed" name="hdnSubscribed" value="{{ subscribed }}" />
                        <div class="field">
                            <label class="label">Email Address</label>
                            <div class="control">
                                <input id="emailAddress" name="emailAddress" class="input" type="email"
                                    value="{{ emailAddress }}" placeholder="Text input">
                            </div>
                        </div>

                        <div class="field">
                            <label class="label">Number of links per email:</label>
                            <div class="control">
                                <div class="select">
                                    <select id="linkCountPerEmail" name="linkCountPerEmail">
                                        <option value="5">5</option>
                                        <option value="10">10</option>
                                        <option value="15">15</option>
                                        <option value="20">20</option>
                                        <option value="30">30</option>
                                    </select>
                                </div>
                            </div>
                        </div>


                        <div class="field">
                            <label class="label">Frequency of emails:</label>
                            <div class="control">
                                <div class="select">
                                    <select name="emailFrequency" id="emailFrequency">
                                        <option value="daily">Daily</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="ever2day">Every 2 days</option>
                                        <option value="ever3day">Every 3 days</option>
                                        <option value="ever4day">Every 4 days</option>
                                        <option value="ever5day">Every 5 days</option>
                                        <option value="ever6day">Every 6 days</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div id="weeklyOnDay" class="field">
                            <label class="label">every:</label>
                            <div class="control">
                                <div class="select">
                                    <select name="weeklyOnDay" id="weeklyOnDay">
                                        <option value="1">Monday</option>
                                        <option value="2">Tuesday</option>
                                        <option value="3">Wednesday</option>
                                        <option value="4">Thursday</option>
                                        <option value="5">Friday</option>
                                        <option value="6">Saturday</option>
                                        <option value="7">Sunday</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="field">
                            <label class="label">In which order would you like to receive links?:</label>
                            <div class="control">
                                <div class="select">
                                    <select name="sortType" id="sortType">
                                        <option value="newest">Newest</option>
                                        <option value="oldest">Oldest</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="field">
                            <div class="control">
                                <label class="checkbox">
                                    <input type="checkbox" name="subscribed" id="subscribed" />
                                    I want my pocket links to be delivered to my inbox.
                                </label>
                            </div>
                        </div>

                        <div class="field">
                            <div class="control">
                                <button class="button is-link">Save</button>
                            </div>
                        </div>
                        <div class="field">
                            <div id="msg"></div>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {

            const emailAddress = $('#hdnEmailAddress').val();
            $("#emailAddress").val(emailAddress);

            const linkCountPerEmail = $('#hdnLinkCountPerEmail').val();
            $("#linkCountPerEmail").val(linkCountPerEmail);

            const emailFrequency = $('#hdnEmailFrequency').val();
            $("#emailFrequency").val(emailFrequency);

            const weeklyOnDay = $('#hdnWeeklyOnDay').val();
            $('#weeklyOnDay option[value=' + weeklyOnDay + ']').prop('selected', 'selected');

            const sortType = $('#hdnSortType').val();
            $("#sortType").val(sortType);

            const subscribed = $('#hdnSubscribed').val();
            $("#subscribed").prop("checked", subscribed == 'true');

            if (emailFrequency !== 'weekly') {
                $("div#weeklyOnDay").hide();
            }

            $('#emailFrequency').on('change', function () {
                if (this.value === 'weekly') {
                    $("div#weeklyOnDay").show();
                } else {
                    $("div#weeklyOnDay").hide();
                }
            });

            // Attach a submit handler to the form
            $("#preferencesForm").submit(function (event) {

                // Stop form from submitting normally
                event.preventDefault();

                // Get some values from elements on the page:
                var $form = $(this),
                    pocketUserName = $form.find("input[name='pocketUserName']").val(),
                    emailAddress = $form.find("input[name='emailAddress']").val(),
                    linkCountPerEmail = $form.find("select[name='linkCountPerEmail']").val(),
                    emailFrequency = $form.find("select[name='emailFrequency']").val(),
                    weeklyOnDay = $form.find("select[name='weeklyOnDay']").val(),
                    sortType = $form.find("select[name='sortType']").val(),
                    subscribed = $form.find("input[name='subscribed']").is(":checked") === true,
                    url = $form.attr("action");

                var data = {
                    pocketUserName: pocketUserName,
                    emailAddress: emailAddress,
                    linkCountPerEmail: linkCountPerEmail,
                    emailFrequency: emailFrequency,
                    weeklyOnDay: weeklyOnDay,
                    sortType: sortType,
                    subscribed: subscribed
                };

                jQuery.ajax({
                    url: url,
                    data: JSON.stringify(data),
                    cache: false,
                    contentType: 'application/json',
                    method: 'POST',
                    type: 'POST', // For jQuery < 1.9
                    success: function (data) {
                        $('#msg').html(
                            "<span style='color: green !important;'><i>Successfully Saved!</i></span>"
                        );
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        $('#msg').html(
                            "<span style='color: red !important;'><i>Something went wrong :(</i></span>"
                        );
                    }
                });
            });
        });
    </script>
</body>

</html>